- name: Ensure the dockermnt directory exists
  file:
    path: /dockermnt
    state: directory
    owner: "{{ management_user }}"
    group: docker
    mode: "775"
  become: yes
  tags: [docker-container, docker-mounts]

- name: Create and start Docker container
  docker_container:
    name: "{{ container_name }}"
    image: "{{ container_image }}"
    cleanup: "{{ cleanup | default('no') }}"
    detach: "{{ detach | default('yes') }}"
    command: "{{ command | default(None) }}"
    network_mode: "{{ network_mode | default('bridge') }}"
    published_ports: "{{ exposed_ports }}"
    state: started
    restart_policy: "{{ restart_policy | default ('always') }}"
    mounts: "{{ mounts | default([]) }}"
  when: "condition | default(True)"
  tags: [docker-container, deploy]